{"ast":null,"code":"import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}import Platform from\"react-native-web/dist/exports/Platform\";import findNodeHandle from\"react-native-web/dist/exports/findNodeHandle\";import ReanimatedModule from\"../ReanimatedModule\";import AnimatedNode from\"./AnimatedNode\";import InternalAnimatedValue from\"./AnimatedValue\";import{createAnimatedAlways}from\"./AnimatedAlways\";import invariant from'fbjs/lib/invariant';import createEventObjectProxyPolyfill from\"./createEventObjectProxyPolyfill\";function sanitizeArgMapping(argMapping){var eventMappings=[];var alwaysNodes=[];var getNode=function getNode(node){if(Platform.OS==='web'||Platform.OS==='windows'||Platform.OS==='macos'){return node;}return node.__nodeID;};var traverse=function traverse(value,path){if(value instanceof InternalAnimatedValue){eventMappings.push(path.concat(getNode(value)));}else if(typeof value==='object'&&value.__val){eventMappings.push(path.concat(getNode(value.__val)));}else if(typeof value==='function'){var node=new InternalAnimatedValue(0);alwaysNodes.push(createAnimatedAlways(value(node)));eventMappings.push(path.concat(getNode(node)));}else if(typeof value==='object'){for(var key in value){traverse(value[key],path.concat(key));}}};invariant(argMapping[0]&&argMapping[0].nativeEvent,'Native driven events only support animated values contained inside `nativeEvent`.');var ev=argMapping[0].nativeEvent;if(typeof ev==='object'){traverse(ev,[]);}else if(typeof ev==='function'){var proxyHandler={get:function get(target,name){if(name==='__isProxy'){return true;}if(!target[name]&&name!=='__val'){target[name]=new Proxy({},proxyHandler);}return target[name];},set:function set(target,prop,value){if(prop==='__val'){target[prop]=value;return true;}return false;}};var proxy=typeof Proxy==='function'?new Proxy({},proxyHandler):createEventObjectProxyPolyfill();alwaysNodes.push(createAnimatedAlways(ev(proxy)));traverse(proxy,[]);}return{eventMappings:eventMappings,alwaysNodes:alwaysNodes};}var AnimatedEvent=function(_AnimatedNode){_inherits(AnimatedEvent,_AnimatedNode);var _super=_createSuper(AnimatedEvent);function AnimatedEvent(argMapping){var _this;var config=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,AnimatedEvent);var _sanitizeArgMapping=sanitizeArgMapping(argMapping),eventMappings=_sanitizeArgMapping.eventMappings,alwaysNodes=_sanitizeArgMapping.alwaysNodes;_this=_super.call(this,{type:'event',argMapping:eventMappings});_defineProperty(_assertThisInitialized(_this),\"__isNative\",true);_this._alwaysNodes=alwaysNodes;return _this;}_createClass(AnimatedEvent,[{key:\"toString\",value:function toString(){return\"AnimatedEvent, id: \".concat(this.__nodeID);}},{key:\"attachEvent\",value:function attachEvent(viewRef,eventName){for(var i=0;i<this._alwaysNodes.length;i++){this._alwaysNodes[i].__attach();}this.__attach();var viewTag=findNodeHandle(viewRef);ReanimatedModule.attachEvent(viewTag,eventName,this.__nodeID);}},{key:\"__onEvaluate\",value:function __onEvaluate(){return 0;}},{key:\"detachEvent\",value:function detachEvent(viewRef,eventName){for(var i=0;i<this._alwaysNodes.length;i++){this._alwaysNodes[i].isNativelyInitialized()&&this._alwaysNodes[i].__detach();}var viewTag=findNodeHandle(viewRef);ReanimatedModule.detachEvent(viewTag,eventName,this.__nodeID);this.__detach();}}]);return AnimatedEvent;}(AnimatedNode);export{AnimatedEvent as default};export function createAnimatedEvent(argMapping,config){return new AnimatedEvent(argMapping,config);}","map":{"version":3,"sources":["AnimatedEvent.js"],"names":["eventMappings","alwaysNodes","getNode","node","Platform","traverse","value","path","createAnimatedAlways","invariant","argMapping","ev","proxyHandler","get","name","target","set","prop","proxy","createEventObjectProxyPolyfill","constructor","config","sanitizeArgMapping","type","toString","attachEvent","i","viewTag","findNodeHandle","ReanimatedModule","__onEvaluate","detachEvent"],"mappings":"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","sourcesContent":["import { Platform, findNodeHandle } from 'react-native';\nimport ReanimatedModule from '../ReanimatedModule';\n\nimport AnimatedNode from './AnimatedNode';\nimport InternalAnimatedValue from './AnimatedValue';\nimport { createAnimatedAlways } from './AnimatedAlways';\n\nimport invariant from 'fbjs/lib/invariant';\nimport createEventObjectProxyPolyfill from './createEventObjectProxyPolyfill';\n\nfunction sanitizeArgMapping(argMapping) {\n  // Find animated values in `argMapping` and create an array representing their\n  // key path inside the `nativeEvent` object. Ex.: ['contentOffset', 'x'].\n  const eventMappings = [];\n  const alwaysNodes = [];\n\n  const getNode = node => {\n    if (Platform.OS === 'web' || Platform.OS === 'windows' || Platform.OS === 'macos') {\n      return node;\n    }\n    return node.__nodeID;\n  };\n\n  const traverse = (value, path) => {\n    if (value instanceof InternalAnimatedValue) {\n      eventMappings.push(path.concat(getNode(value)));\n    } else if (typeof value === 'object' && value.__val) {\n      eventMappings.push(path.concat(getNode(value.__val)));\n    } else if (typeof value === 'function') {\n      const node = new InternalAnimatedValue(0);\n      alwaysNodes.push(createAnimatedAlways(value(node)));\n      eventMappings.push(path.concat(getNode(node)));\n    } else if (typeof value === 'object') {\n      for (const key in value) {\n        traverse(value[key], path.concat(key));\n      }\n    }\n  };\n\n  invariant(\n    argMapping[0] && argMapping[0].nativeEvent,\n    'Native driven events only support animated values contained inside `nativeEvent`.'\n  );\n\n  // Assume that the event containing `nativeEvent` is always the first argument.\n  const ev = argMapping[0].nativeEvent;\n  if (typeof ev === 'object') {\n    traverse(ev, []);\n  } else if (typeof ev === 'function') {\n    const proxyHandler = {\n      get: function(target, name) {\n        if (name === '__isProxy') {\n          return true;\n        }\n        if (!target[name] && name !== '__val') {\n          target[name] = new Proxy({}, proxyHandler);\n        }\n        return target[name];\n      },\n      set: function(target, prop, value) {\n        if (prop === '__val') {\n          target[prop] = value;\n          return true;\n        }\n        return false;\n      },\n    };\n\n    const proxy =\n      typeof Proxy === 'function'\n        ? new Proxy({}, proxyHandler)\n        : createEventObjectProxyPolyfill();\n    alwaysNodes.push(createAnimatedAlways(ev(proxy)));\n    traverse(proxy, []);\n  }\n\n  return { eventMappings, alwaysNodes };\n}\n\nexport default class AnimatedEvent extends AnimatedNode {\n  constructor(argMapping, config = {}) {\n    const { eventMappings, alwaysNodes } = sanitizeArgMapping(argMapping);\n    super({ type: 'event', argMapping: eventMappings });\n    this._alwaysNodes = alwaysNodes;\n  }\n\n  toString() {\n    return `AnimatedEvent, id: ${this.__nodeID}`;\n  }\n\n  // The below field is a temporary workaround to make AnimatedEvent object be recognized\n  // as Animated.event event callback and therefore filtered out from being send over the\n  // bridge which was causing the object to be frozen in JS.\n  __isNative = true;\n\n  attachEvent(viewRef, eventName) {\n    for (let i = 0; i < this._alwaysNodes.length; i++) {\n      this._alwaysNodes[i].__attach();\n    }\n    this.__attach();\n    const viewTag = findNodeHandle(viewRef);\n    ReanimatedModule.attachEvent(viewTag, eventName, this.__nodeID);\n  }\n\n  __onEvaluate() {\n    return 0;\n  }\n\n  detachEvent(viewRef, eventName) {\n    for (let i = 0; i < this._alwaysNodes.length; i++) {\n      this._alwaysNodes[i].isNativelyInitialized() &&\n        this._alwaysNodes[i].__detach();\n    }\n    const viewTag = findNodeHandle(viewRef);\n    ReanimatedModule.detachEvent(viewTag, eventName, this.__nodeID);\n    this.__detach();\n  }\n}\n\nexport function createAnimatedEvent(argMapping, config) {\n  return new AnimatedEvent(argMapping, config);\n}\n"]},"metadata":{},"sourceType":"module"}